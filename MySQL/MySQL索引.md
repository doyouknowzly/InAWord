# 二、索引

| 序号 | 问题                                                         | 一句话解释                                                   | 详细知识点                                                   |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 0    | B+ 树是什么？为什么被MySQL采用作为索引的数据结构？           | <br>优点：IO读取次数少（每次都是页读取），范围查找更快捷（相邻页之间有指针） | [深入理解 MySQL 索引底层原理](https://zhuanlan.zhihu.com/p/113917726) |
| 1    | B+树和其他树的对比                                           |                                                              |                                                              |
| 2    | MySQL都有哪些索引？使用场景都是哪些？                        | 主键索引<br>辅助索引<br>聚簇索引<br>非聚簇索引<br>全文索引<br>唯一索引<br>主键索引<br>组合索引<br> |                                                              |
| 3    | 聚簇索引（也叫聚集索引， cluster index） 是什么？为什么比普通索引快？ | 数据和索引放在一起，放在B+树的叶子节点上，不需要根据地址再去查一下具体数据是多少 |                                                              |
| 4    | InnoDB的B+树索引叶子节点的Data域存储的是什么？MyISAM的呢？   | MyISAM 引擎把数据和索引分开了，一人一个文件，这叫做非聚集索引方式<br>(.MYD文件:表里面的数据文件（myisam data）<br>.MYI文件:表里面的索引文件（myisam index）)；<br><br>树的叶子节点存的是对应数据的物理地址。我们拿到这个物理地址后，就可以到 MyISAM 数据文件中直接定位到具体的数据记录了<br><br>Innodb引擎把数据和索引放在同一个文件里了，这叫做聚集索引方式(.idb文件:表里面的数据+索引文件) <br> InnoDB 只在主键索引树内使用聚簇索引，因为其他索引也存数据的话，太浪费空间了 <br> | [深入理解 MySQL 索引底层原理](https://zhuanlan.zhihu.com/p/113917726) |
| 5    | MySQL索引什么时候会失效                                      | 一、使用联合索引a,b时，未使用最左前缀规则<br> 二、使用like的时候没有使用左前缀，比如where subject like "%game"<br> 三、搜索一个索引而在另一个索引上做order by，where A=a order by B <br>四、where A = a1 or B = b1会失效，因为是2个索引， where A = a1 or A = a2时生效<br>五、varchar类型的时候如果没加"",就会做类型转换，然后索引失效 | [MySQL索引——分类、何时使用、何时不使用、何时失效](https://blog.csdn.net/weixin_39420024/article/details/80040549) |
| 6    | 索引覆盖是什么意思？回表呢？                                 | select a,b,c where a=1 and b = 3 and c =  10就会覆盖，即查询的数据，在where条件里都有，就不需要查到主键后，再去聚簇索引查一遍数据(回表)；<br>但 select * from where 主键 = 3 这样的SQL也不需要回表，因为InnoDb默认聚簇索引就建立在主键上，数据和主键都在主键索引的数据节点 上 | [到底什么情况下MySQL innodb会发生回表操作?](https://www.zhihu.com/question/347087093/answer/830934717) |





## 详细知识点阐述  

### 0. **B+ 树是什么？为什么被MySQL采用作为索引的数据结构？** 

**核心思路**:   

   - 索引文件很大，是存在磁盘中的，一次只能读取几页的索引到内存中，所以要尽量**减少IO读取次数**  
     **优点**:
   - 1.  数据都在叶子节点，查询效率稳定
   - 2. 相近的节点在叶子节点的逻辑上邻近的，在索引文件的物理存储中也是相近的，可以1次都加载进来，可能不需要多次读磁盘\刷内存的操作 
   - 3. 存在叶子节点间的链表指针，方便select \*进行扫库，从任意一个节点都可以遍历完全表   

### 1. **B+树和其他树的对比**

- **二叉查找树(binary Search)**：左子树的键值小于根的键值，右子树的键值大于根的键值； 缺点:不平衡的时候，其实和链表是一样的，效率很低<br> 
- **平衡二叉树(AVL Tree)**  add和remove的时候会自动旋转，用来保持平衡，即根节点两边的子节点数量尽量一致<br>  
- **平衡多路查找树(B-tree，-是分割，不是减)** 所有键值分布在整个树中；叶子节点不需要非是2;<br>关键字越少，层数越高，IO次数越多，所以有要求【m叉查找树内，除了根结点外，任何结点至少有 m/2 个分叉，即至少含有m/2 -1个关键字】 <br> 
- **B+树** 叶子节点不需要非是2个;不需要经常平衡; 数据全部在叶子节点上；叶子节点间加入链表指针，优化where等范围查找时的性能<br> B+树的创造者，Rudolf Bayer没有解释B代表什么，最常见的观点是B代表平衡(balanced)

> 参考文档 [<<那么多的树，一文全总结>>](> https://segmentfault.com/a/1190000038444596?utm_source=tag-newest)



