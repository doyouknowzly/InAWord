# TCPBase



<img src="https://img-blog.csdnimg.cn/20200314211133115.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zNzc1MDkwMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" style="zoom: 80%;" />

| 序号 | 问题        | 一句话总结 |
| ---- | -------------------------- | --- |
| 0 | 端口号 | 作用 : 区别进程id |
| 1    | TCP协议的报文概述          ||
| 2    | TCP和UDP的区别     ||
| 3 | 为什么要3次握手，2次不行么 |                                                              |
| 4 | 为什么要4次挥手 ||
| 5    | TCP的滑动窗口             | 场景：处理consumer和provider处理速度不匹配的问题             |
| 6    | TCP的拥塞控制              |场景: 网络中报文过多，互相竞争导致拥塞怎么办？<br>手段: 慢启动、拥塞避免、快速重传、快速恢复|
| 7    | TCP协议的可靠性如何保证 ||
| 8    | TCP粘包问题                ||
| 9    | 长、短连接                 ||
| 10 | 为什么要超时重试 ||
| 11 | RTT动态计算的作用 ||
| 12 | TCP双方可能的状态有哪些 |                                                              |
| 13 | Syn攻击是什么 |                                                              |





## 0. 端口号

- 作用 : 区别同一主机 内的不同应用程序 (进程 )
- 2次通信如何算 相同的通信呢
  - 源ip 一致
  - 源端口 一致
  - 协议一致 
  - 目标ip一致
  - 目标端口一致
- 端口分类
  - 既定端口号(静态端口号) 
    - 已经有知名应用占用了，比如ssh是22， http是80
    - 范围是 0 ~ 1023
  - 不太知名的应用占用
    - 范围 1024 ~ 49151
  - 动态端口号
    - 服务端确定端口号， 客户端不需要确定， 使用操作系统动态分配。(自增 + 1)
    - 范围是 49152 ~ 65535



## 1. TCP报文是怎样的  
![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/340bfe6be9094116b12ea3f1ed8f0a5c~tplv-k3u1fbpfcp-watermark.image)
-  序列号seq：占4个字节，用来标记数据段的顺序，TCP把连接中发送的所有数据字节都编上一个序号，第一个字节的编号由本地随机产生；给字节编上序号后，就给每一个报文段指派一个序号；序列号seq就是这个报文段中的第一个字节的数据编号。

- 确认号ack：占4个字节，期待收到对方下一个报文段的第一个数据字节的序号；序列号表示报文段携带数据的第一个字节的编号；而确认号指的是期望接收到下一个字节的编号；因此当前报文段最后一个字节的编号+1即为确认号。

- 确认ACK：占1位，`仅当ACK=1时，确认号字段才有效`。ACK=0时，确认号无效

- 同步SYN：连接建立时用于同步序号。当SYN=1，ACK=0时表示：这是一个连接请求报文段。若同意连接，则在响应报文段中使得SYN=1，ACK=1。因此，SYN=1表示这是一个连接请求，或连接接受报文。SYN这个标志位只有在TCP建产连接时才会被置1，握手完成后SYN标志位被置0。

- 终止FIN：用来释放一个连接。FIN=1表示：此报文段的发送方的数据已经发送完毕，并要求释放运输连接

> PS：ACK、SYN和FIN这些大写的单词表示`标志位`，其值要么是1，要么是0；ack、seq小写的单词表示`序号`。




## 2 TCP和UDP的区别  

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e72ce7f07a3a483087cbab160743699e~tplv-k3u1fbpfcp-watermark.image)   

- UDP比TCP快在哪里
 - UDP要不要握手





- 






## 8. 粘包

## 9. 长、短连接



## 13.SYN攻击是什么

SYN 攻击是一种典型的 DoS/DDoS 攻击。

**服务器端的资源分配是在二次握手时分配的，而客户端的资源是在完成三次握手时分配的**，所以服务器容易受到SYN洪泛攻击。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server则回复确认包，并等待Client确认，由于源地址不存在，因此Server需要不断重发直至超时，这些伪造的SYN包将长时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪。

检测 SYN 攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击。在 Linux/Unix 上可以使用系统自带的 netstats 命令来检测 SYN 攻击。

```
netstat -n -p TCP | grep SYN_RECV
```

常见的防御 SYN 攻击的方法有如下几种：

- 缩短超时（SYN Timeout）时间
- 增加最大半连接数
- 过滤网关防护
- SYN cookies技术



## 参考资料

1. [TCP协议详解](https://juejin.cn/post/6844903685563105293)