# 分布式概念



## 一、CAP定理

1998年，加州大学的计算机科学家 Eric Brewer 提出

在一个分布式系统中， Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），三者不可得兼。



一致性（C）：在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）

可用性（A）：保证每个请求不管成功或者失败都有响应。

分区容错性（P）：系统中任意信息的丢失或失败不会影响系统的继续运作

- 大多数分布式系统都分布在多个子网络。每个子网络就叫做一个区
- 分区容错的意思是，区间通信可能失败。比如，一台服务器放在中国，另一台服务器放在美国，这就是两个区，它们之间可能无法通信。

![img](https://www.wangbase.com/blogimg/asset/201807/bg2018071607.jpg)

CAP原则的精髓就是要么AP，要么CP，要么AC，但是不存在CAP

- 一般情况下，分区容错性一定需要，(就目前的网络模型，几乎保证不了分区之间不出错)，即必须满足P

- 有些场景下，服务可以不可用，比如秒杀、抢购时，限流、降级导致都没进入秒杀流程，其实就是不可用了
- 一般大家还是会舍弃一致性，比如有些用户拿到新的页面，有些用户是旧的页面



| 取舍 | 分析                                                         |
| ---- | ------------------------------------------------------------ |
| CA   | 放弃分区容错性，加强一致性和可用性，其实就是传统的单机数据库的选择 |
| AP   | 放弃一致性（这里说的一致性是强一致性），追求分区容错性和可用性，这是很多分布式系统设计时的选择，例如很多NoSQL系统就是如此 |
| CP   | 放弃可用性，追求一致性和分区容错性，基本不会选择，网络问题会直接让整个系统不可用 |



## 二、BASE

BASE理论是Basically Available(基本可用)，Soft State（软状态）和Eventually Consistent（最终一致性）三个短语的缩写。

- 基本可用（Basically Available）
  假设系统，出现了不可预知的故障，但还是能用，相比较正常的系统而言：

  响应时间上的损失：正常情况下的搜索引擎0.5秒即返回给用户结果，而基本可用的搜索引擎可以在2秒作用返回结果。

  功能上的损失：在一个电商网站上，正常情况下，用户可以顺利完成每一笔订单。但是到了大促期间，为了保护购物系统的稳定性，部分消费者可能会被引导到一个降级页面。

- 软状态（Soft State）
  允许系统中的数据存在中间状态，并认为该状态不影响系统的整体可用性，即允许系统在多个不同节点的数据副本存在数据延时。

- 最终一致性（Eventually Consistent）
  	系统中所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态而不需要实时保证系统数据的强一致性。



**和CAP的关系**

