# Redis持久化



| 序号 | 问题        | 一句话总结                                                   | 参考文档 |
| ---- | ----------- | ------------------------------------------------------------ | -------- |
| 0    | RDB持久化   | Redis如果开启了AOF和RDB，会优先使用AOF，因为性能更好<br>**RDB是快照方式**，周期性地持久化快照, 更耗时、更密集地消耗资源; <br> 但假设持久化周期是5min,最差的情况下会丢失5min的数据 <br> **SAVE命令**会阻塞主进程，直到生成完RDB文件后才响应客户端;一般不使用 <br>**BGSAVE命令**会派生出一个子进程写RDB文件<br> |          |
| 1    | AOF         | **AOF**是增量地，append only地记录每条操作的指令，就很像mysql的binlog.<br>命令先写到**AOF缓冲区**内，默认每秒都要去异步刷新一次日志，进行fsync。<br>**优点**:AOF是1秒1次的，最多丢失1秒的数据，数据一致性更强。<br>**缺点**:同样的数据，AOF文件更大更占空间 |          |
| 2    | AOF重写原理 | 时间久了以后，AOF文件很大，而且很多都是用不到的，比如[set a 123; set a 456; set a 789],其实最终只需要789就行了<br>**原理** : 没有使用分析、合并命令的思路，而是类似RDB一样，分析当前集群的数据状态，生成的命令集合。<br>会新启动一个进程异步进行AOF重写，此时还会多一个**AOF重写缓冲区**，主进程的命令在执行完后，还会同时将命令追加打AOF缓冲区和AOF重写缓冲区 |          |

