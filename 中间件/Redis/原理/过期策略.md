# Redis过期策略

逻辑上，我们可以给key设置过期时间，时间一到，key就销毁了

物理上，其实不是立即删除的，因为Redis是单线程模型的，如果核心线程每时每刻都要监控 : **有哪些key要过期啦，赶紧去删除一下**， 就会频繁切换当前执行的job， 可能会造成client请求的卡顿。

> 所以，Redis的作者也想到了，没有使用简单的"到期立即删除"逻辑。



### 一、思路

​	redis 会将每个设置了过期时间的 key 放入到一个独立的字典中，以后会定时遍历这个 字典来删除到期的 key。

​	除了定时遍历之外，它还会使用惰性策略来删除过期的 key，所谓 惰性策略就是在客户端访问这个 key 的时候，redis 对 key 的过期时间进行检查，如果过期 了就立即删除。

​	定时删除是集中处理，惰性删除是零散处理。



### 二、具体策略

​	Redis 默认会每秒进行十次过期扫描，过期扫描不会遍历过期字典中所有的 key，而是 采用了一种简单的贪心策略。

1. 从过期字典中随机 20 个 key； 
2. 删除这 20 个 key 中已经过期的 key； 
3. 如果过期的 key 比率超过 1/4，那就重复步骤 1；



同时，为了保证过期扫描不会出现循环过度，导致线程卡死现象，算法还增加了扫描时 间的上限，默认不会超过 25ms。