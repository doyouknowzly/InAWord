# Redis高可用

[toc]



Redis高可用的发展历史

- 主从同步
- Sentinel
- Cluster集群模式



## 主从同步

Redis中的节点分为主、从节点。**主节点写，从节点读**

1. 主节点会异步将数据同步到从节点，不阻塞主节点写入

2. 如果某个主节点不响应Ping了，就会在集群内选举其从节点的一个，作为新的主节点。负责之前的槽位，[选举算法基于Raft]

   

   

复制的策略有：增量同步、快照同步、无盘复制。

1. 大部分时候都是正常的，主、从之间使用增量同步；
   - 但是如果忽然网络不好，导致几秒钟的数据没有同步。
   - 等到网络恢复的时候，再使用增量同步肯定不行
2. 网络恢复以后，要使用更复杂的快照同步
   - 先使用bgsave，将主节点的数据快照到磁盘
   - 然后将磁盘数据通过网络完整地传给从节点
   - 从节点接受完毕后，要清除自己的数据，然后加载刚才同步的数据



## Sentinel

在 Redis 3.0 之前，只能使用 哨兵（sentinel）机制来监控各个节点之间的状态。哨兵节点只能作监控使用，本质是额外启动哨兵节点去监控数据节点。



## Cluster集群模式



**优点**：

- 解决横向扩容问题；
- 数据节点自己进行决策，不需要浪费资源部署哨兵节点。



|      |      |      |
| ---- | ---- | ---- |
|      |      |      |
|      |      |      |
|      |      |      |
